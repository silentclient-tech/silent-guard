<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø£Ù…Ù†ÙŠØ© - Silent Guard Ultra</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; }
        .badge { border-radius: 9999px; padding: 0.25rem 0.75rem; font-size: 0.75rem; }
    </style>
</head>

<body class="bg-gray-100 min-h-screen">
<header class="bg-gray-900 text-white py-4 shadow">
    <div class="container mx-auto px-6 flex justify-between items-center">
        <div class="flex items-center space-x-3 space-x-reverse">
            <svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622
                       5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
            </svg>
            <div>
                <h1 class="text-xl font-bold">Silent Guard Ultra</h1>
                <p class="text-xs text-gray-400">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ù…Ù†ÙŠØ©</p>
            </div>
        </div>
        <div class="text-xs text-gray-400">
            Ù…ÙØªØ§Ø­ Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ:
            <code class="bg-gray-800 text-green-300 px-2 py-1 rounded">{{ admin_key }}</code>
        </div>
    </div>
</header>

<main class="container mx-auto px-6 py-8">

    <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white rounded-xl shadow p-5">
            <p class="text-xs text-gray-500 mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</p>
            <p class="text-3xl font-bold text-gray-800">{{ total_events }}</p>
            <p class="text-xs text-gray-400 mt-2">ÙŠØ´Ù…Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© ÙˆÙ…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù‡Ø¬ÙˆÙ….</p>
        </div>

        <div class="bg-white rounded-xl shadow p-5">
            <p class="text-xs text-gray-500 mb-1">Ø¹Ø¯Ø¯ Ø§Ù„Ù€ IPs Ø§Ù„Ù…Ø­Ø¬ÙˆØ¨Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
            <p class="text-3xl font-bold text-red-600">{{ blocked_ips_count }}</p>
            <p class="text-xs text-gray-400 mt-2">Ø§Ù„Ø­Ø¸Ø± ÙŠØªÙ… Ø¢Ù„ÙŠØ§Ù‹ Ø¨ÙˆØ§Ø³Ø·Ø© Ù…Ø­Ø±Ùƒ Ø§Ù„Ù…Ø®Ø§Ø·Ø±.</p>
        </div>

        <div class="bg-white rounded-xl shadow p-5">
            <p class="text-xs text-gray-500 mb-2">ØªÙˆØ²ÙŠØ¹ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø®Ø·ÙˆØ±Ø©</p>
            <div class="flex flex-wrap gap-2">
                {% for level, count in risk_counts.items() %}
                    {% set color = 'bg-gray-200 text-gray-800' %}
                    {% if level == 'Critical' %}
                        {% set color = 'bg-red-600 text-white' %}
                    {% elif level == 'High' %}
                        {% set color = 'bg-orange-500 text-white' %}
                    {% elif level == 'Medium' %}
                        {% set color = 'bg-yellow-400 text-gray-900' %}
                    {% elif level == 'Low' %}
                        {% set color = 'bg-green-500 text-white' %}
                    {% endif %}
                    <span class="badge {{ color }}">
                        {{ level }} : {{ count }}
                    </span>
                {% endfor %}
                {% if risk_counts|length == 0 %}
                    <span class="badge bg-gray-200 text-gray-600">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</span>
                {% endif %}
            </div>
        </div>
    </section>

    <!-- ğŸ”¥ğŸ”¥ Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ğŸ”¥ğŸ”¥ -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">

        <!-- Ù…Ø®Ø·Ø· Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø³ØªÙ‡Ø¯Ø§ÙÙ‹Ø§ -->
        <div class="bg-white rounded-xl shadow p-5">
            <div class="flex justify-between items-center mb-3">
                <h2 class="font-bold text-gray-800 text-sm">Ø£ÙƒØ«Ø± Ø§Ù„ØµÙØ­Ø§Øª Ø£Ùˆ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª ØªØ¹Ø±Ø¶Ù‹Ø§ Ù„Ù„Ù‡Ø¬Ù…Ø§Øª</h2>
                <span class="badge bg-red-50 text-red-600 border border-red-100">
                    Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‡Ø¬Ù…Ø§Øª: {{ attack_events_count }}
                </span>
            </div>

            <div class="h-64">
                <canvas id="attackPathsChart"></canvas>
            </div>
        </div>

        <!-- Ù…Ø®Ø·Ø· Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø®Ø·ÙˆØ±Ø© -->
        <div class="bg-white rounded-xl shadow p-5">
            <h2 class="font-bold text-gray-800 text-sm mb-3">ØªÙˆØ²ÙŠØ¹ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø®Ø·ÙˆØ±Ø©</h2>

            <div class="h-64">
                <canvas id="riskLevelsChart"></canvas>
            </div>
        </div>

    </section>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« -->
    <section class="bg-white rounded-xl shadow overflow-hidden mb-8">
        <div class="px-5 py-3 border-b border-gray-200 flex justify-between items-center">
            <h2 class="font-bold text-gray-800 text-sm">Ø¢Ø®Ø± Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ© (Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰ 80 Ø­Ø¯Ø«)</h2>
            <span class="text-xs text-gray-400">Ø§Ù„Ø£Ø­Ø¯Ø« ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„</span>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full text-xs md:text-sm">
                <thead class="bg-gray-100">
                <tr>
                    <th class="px-3 py-2 text-right text-gray-600">Ø§Ù„ÙˆÙ‚Øª</th>
                    <th class="px-3 py-2 text-right text-gray-600">IP Ø§Ù„Ù…Ø³Ø¬Ù„</th>
                    <th class="px-3 py-2 text-right text-gray-600">Ø§Ù„Ù…Ø³Ø§Ø±</th>
                    <th class="px-3 py-2 text-right text-gray-600">Ø§Ù„Ø®Ø¯Ù…Ø©</th>
                    <th class="px-3 py-2 text-right text-gray-600">Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©</th>
                    <th class="px-3 py-2 text-right text-gray-600">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th>
                </tr>
                </thead>

                <tbody>
                {% for e in events %}
                    <tr class="border-t border-gray-100 hover:bg-gray-50">
                        <td class="px-3 py-2 text-gray-700">{{ e.timestamp }}</td>
                        <td class="px-3 py-2 text-gray-700">{{ e.ip }}</td>
                        <td class="px-3 py-2 text-gray-700">{{ e.endpoint }}</td>
                        <td class="px-3 py-2 text-gray-700">{{ e.service }}</td>
                        <td class="px-3 py-2 text-gray-700 text-xs">{{ e.rule_triggered }}</td>
                        <td class="px-3 py-2">
                            {% set level = e.risk_level %}
                            {% set color = 'bg-gray-200 text-gray-800' %}
                            {% if level == 'Critical' %}
                                {% set color = 'bg-red-600 text-white' %}
                            {% elif level == 'High' %}
                                {% set color = 'bg-orange-500 text-white' %}
                            {% elif level == 'Medium' %}
                                {% set color = 'bg-yellow-400 text-gray-900' %}
                            {% elif level == 'Low' %}
                                {% set color = 'bg-green-500 text-white' %}
                            {% endif %}
                            <span class="badge {{ color }}">{{ level }}</span>
                        </td>
                    </tr>
                {% endfor %}

                {% if events|length == 0 %}
                    <tr>
                        <td colspan="6" class="px-3 py-6 text-center text-gray-400 text-sm">
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø­Ø¯Ø§Ø« Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯. Ù‚Ù… Ø¨Ù…Ø­Ø§ÙˆÙ„Ø© Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø²ÙŠØ§Ø±Ø© Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù…ØµØ§Ø¦Ø¯ Ù„Ø¹Ø±Ø¶ Ù…Ø«Ø§Ù„.
                        </td>
                    </tr>
                {% endif %}
                </tbody>
            </table>
        </div>
    </section>

</main>

<!-- ========================= -->
<!--      Ù…Ø®Ø·Ø·Ø§Øª Chart.js     -->
<!-- ========================= -->
<script>
document.addEventListener("DOMContentLoaded", function () {

    // Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø®Ø·Ø· Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø³ØªÙ‡Ø¯Ø§ÙÙ‹Ø§
    const attackPathsLabels = {{ attack_paths_labels | tojson | safe }};
    const attackPathsCounts = {{ attack_paths_counts | tojson | safe }};

    // Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø®Ø·ÙˆØ±Ø©
    const riskLabels = {{ risk_chart_labels | tojson | safe }};
    const riskValues = {{ risk_chart_values | tojson | safe }};

    /* ---------------------------
       Ù…Ø®Ø·Ø· Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª (Bar Chart)
       --------------------------- */
    const ctx1 = document.getElementById("attackPathsChart");
    if (ctx1 && attackPathsLabels.length > 0) {
        new Chart(ctx1, {
            type: "bar",
            data: {
                labels: attackPathsLabels,
                datasets: [{
                    label: "Ø¹Ø¯Ø¯ Ø§Ù„Ù‡Ø¬Ù…Ø§Øª",
                    data: attackPathsCounts,
                    borderWidth: 1.5,
                    borderRadius: 6,
                    backgroundColor: [
                        "#ef4444",
                        "#f97316",
                        "#eab308",
                        "#22c55e",
                        "#3b82f6",
                        "#a855f7",
                        "#ec4899"
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    }

    /* ---------------------------
       Ù…Ø®Ø·Ø· Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø®Ø·ÙˆØ±Ø© (Donut)
       --------------------------- */
    const ctx2 = document.getElementById("riskLevelsChart");
    if (ctx2 && riskLabels.length > 0) {
        new Chart(ctx2, {
            type: "doughnut",
            data: {
                labels: riskLabels,
                datasets: [{
                    data: riskValues,
                    backgroundColor: riskLabels.map(lvl => {
                        if (lvl === "Critical") return "#ef4444";
                        if (lvl === "High") return "#f97316";
                        if (lvl === "Medium") return "#eab308";
                        if (lvl === "Low") return "#22c55e";
                        return "#6b7280";
                    })
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: "60%",
                plugins: {
                    legend: {
                        position: "bottom"
                    }
                }
            }
        });
    }

});
</script>

</body>
</html>
